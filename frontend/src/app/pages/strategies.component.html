<div class="container">
  <div class="header">
    <h1>ç­–ç•¥ç®¡ç†</h1>
    <button class="btn btn-primary" (click)="showCreateForm()">
      â• å»ºç«‹æ–°ç­–ç•¥
    </button>
  </div>

  <!-- å»ºç«‹/ç·¨è¼¯è¡¨å–® -->
  <div class="form-card" *ngIf="showForm">
    <h2>{{ isEditing ? 'ç·¨è¼¯ç­–ç•¥' : 'å»ºç«‹ç­–ç•¥' }}</h2>
    <form (ngSubmit)="saveStrategy()">
      <div class="form-row">
        <div class="form-group">
          <label>ç­–ç•¥åç¨± *</label>
          <input
            type="text"
            [(ngModel)]="currentStrategy.strategy_name"
            name="strategy_name"
            [disabled]="isEditing"
            required
            placeholder="ä¾‹å¦‚ï¼šTXF_vivi_mini">
        </div>
        <div class="form-group">
          <label>èªªæ˜</label>
          <input
            type="text"
            [(ngModel)]="currentStrategy.description"
            name="description"
            placeholder="ç­–ç•¥æè¿°">
        </div>
      </div>

      <h3>ğŸ¯ å•†å“è¨­å®š</h3>
      <div class="form-row">
        <div class="form-group">
          <label>è¨Šè™Ÿå•†å“ä»£ç¢¼ *</label>
          <input
            type="text"
            [(ngModel)]="currentStrategy.source_product"
            name="source_product"
            required
            placeholder="TXFF5">
          <small>TradingView è¨Šè™Ÿä¸­çš„å•†å“ä»£ç¢¼</small>
        </div>
        <div class="form-group">
          <label>å¯¦éš›ä¸‹å–®å•†å“ *</label>
          <input
            type="text"
            [(ngModel)]="currentStrategy.target_product"
            name="target_product"
            required
            placeholder="MXFF5">
          <small>å¯¦éš›è¦ä¸‹å–®çš„å•†å“ä»£ç¢¼</small>
        </div>
      </div>

      <h3>ğŸ“Š æ•¸é‡è¨­å®š</h3>
      <div class="form-row">
        <div class="form-group">
          <label>å£æ•¸å€æ•¸ *</label>
          <input
            type="number"
            [(ngModel)]="currentStrategy.quantity_multiplier"
            name="quantity_multiplier"
            min="1"
            required>
          <small>è¨Šè™Ÿæ•¸é‡ Ã— æ­¤å€æ•¸ = å¯¦éš›ä¸‹å–®å£æ•¸</small>
        </div>
        <div class="form-group">
          <label>æœ€å¤§æŒå€‰</label>
          <input
            type="number"
            [(ngModel)]="currentStrategy.max_position"
            name="max_position"
            min="1">
        </div>
      </div>

      <h3>ğŸ“¥ é€²å ´è¨­å®š</h3>
      <div class="form-row">
        <div class="form-group">
          <label>é€²å ´å–®åˆ¥</label>
          <select [(ngModel)]="currentStrategy.entry_order_type" name="entry_order_type">
            <option value="L">é™åƒ¹å–® (L)</option>
            <option value="M">å¸‚åƒ¹å–® (M)</option>
            <option value="P">ç¯„åœå¸‚åƒ¹ (P)</option>
          </select>
        </div>
        <div class="form-group">
          <label>é€²å ´å§”è¨—æ¢ä»¶</label>
          <select [(ngModel)]="currentStrategy.entry_order_condition" name="entry_order_condition">
            <option value="R">ROD (R)</option>
            <option value="I">IOC (I)</option>
            <option value="F">FOK (F)</option>
          </select>
        </div>
      </div>

      <h3>ğŸ“¤ å‡ºå ´è¨­å®š</h3>
      <div class="form-row">
        <div class="form-group">
          <label>å‡ºå ´å–®åˆ¥</label>
          <select [(ngModel)]="currentStrategy.exit_order_type" name="exit_order_type">
            <option value="L">é™åƒ¹å–® (L)</option>
            <option value="M">å¸‚åƒ¹å–® (M)</option>
            <option value="P">ç¯„åœå¸‚åƒ¹ (P)</option>
          </select>
        </div>
        <div class="form-group">
          <label>å‡ºå ´å§”è¨—æ¢ä»¶</label>
          <select [(ngModel)]="currentStrategy.exit_order_condition" name="exit_order_condition">
            <option value="R">ROD (R)</option>
            <option value="I">IOC (I)</option>
            <option value="F">FOK (F)</option>
          </select>
        </div>
      </div>

      <h3>âš™ï¸ å…¶ä»–è¨­å®š</h3>
      <div class="form-row">
        <div class="form-group">
          <label>ç•¶æ²–</label>
          <select [(ngModel)]="currentStrategy.dtrade" name="dtrade">
            <option value="N">å¦ (N)</option>
            <option value="Y">æ˜¯ (Y)</option>
          </select>
        </div>
        <div class="form-group">
          <label>å¸³è™Ÿ</label>
          <input
            type="text"
            [(ngModel)]="currentStrategy.account"
            name="account"
            placeholder="ç•™ç©ºä½¿ç”¨ç’°å¢ƒè®Šæ•¸">
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="cancelForm()">å–æ¶ˆ</button>
        <button type="submit" class="btn btn-primary">{{ isEditing ? 'æ›´æ–°' : 'å»ºç«‹' }}</button>
      </div>
    </form>
  </div>

  <!-- ç­–ç•¥åˆ—è¡¨ -->
  <div class="strategies-grid">
    <div *ngFor="let strategy of strategies" class="strategy-card" [class.disabled]="!strategy.enabled">
      <div class="strategy-header">
        <h3>{{ strategy.strategy_name }}</h3>
        <div class="strategy-actions">
          <button
            class="btn-icon"
            [class.active]="strategy.enabled"
            (click)="toggleStrategy(strategy.strategy_name)"
            [title]="strategy.enabled ? 'åœç”¨' : 'å•Ÿç”¨'">
            {{ strategy.enabled ? 'âœ…' : 'â­•' }}
          </button>
          <button class="btn-icon" (click)="editStrategy(strategy)" title="ç·¨è¼¯">âœï¸</button>
          <button class="btn-icon danger" (click)="deleteStrategy(strategy.strategy_name)" title="åˆªé™¤">ğŸ—‘ï¸</button>
        </div>
      </div>

      <div class="strategy-info">
        <div class="info-row">
          <span class="label">å•†å“æ˜ å°„ï¼š</span>
          <span class="value">{{ strategy.source_product }} â†’ {{ strategy.target_product }}</span>
        </div>
        <div class="info-row">
          <span class="label">å£æ•¸å€æ•¸ï¼š</span>
          <span class="value highlight">Ã—{{ strategy.quantity_multiplier }}</span>
        </div>
        <div class="info-row">
          <span class="label">é€²å ´ï¼š</span>
          <span class="value">{{ getOrderTypeLabel(strategy.entry_order_type) }} / {{ getConditionLabel(strategy.entry_order_condition) }}</span>
        </div>
        <div class="info-row">
          <span class="label">å‡ºå ´ï¼š</span>
          <span class="value">{{ getOrderTypeLabel(strategy.exit_order_type) }} / {{ getConditionLabel(strategy.exit_order_condition) }}</span>
        </div>
        <div class="info-row" *ngIf="strategy.dtrade === 'Y'">
          <span class="label">ç•¶æ²–ï¼š</span>
          <span class="value badge">æ˜¯</span>
        </div>
        <div class="info-row" *ngIf="strategy.description">
          <span class="label">èªªæ˜ï¼š</span>
          <span class="value">{{ strategy.description }}</span>
        </div>
      </div>

      <div class="strategy-footer">
        <small>å»ºç«‹ï¼š{{ formatDate(strategy.created_at) }}</small>
        <small *ngIf="strategy.updated_at">æ›´æ–°ï¼š{{ formatDate(strategy.updated_at) }}</small>
      </div>
    </div>
  </div>

  <div *ngIf="strategies.length === 0 && !loading" class="empty-state">
    <p>å°šæœªå»ºç«‹ä»»ä½•ç­–ç•¥</p>
    <button class="btn btn-primary" (click)="showCreateForm()">å»ºç«‹ç¬¬ä¸€å€‹ç­–ç•¥</button>
  </div>

  <div *ngIf="loading" class="loading">è¼‰å…¥ä¸­...</div>
  <div *ngIf="error" class="error">{{ error }}</div>
</div>
